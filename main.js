(()=>{"use strict";var e=document.querySelector(".profile__avatar-n-info"),t=e.querySelector(".profile__title"),o=e.querySelector(".profile__subtitle"),n=e.querySelector(".profile__edit"),r=document.querySelector(".popup_edit"),c=(r.querySelector(".popup__close-button"),r.querySelector(".popup__input_type_user-name")),u=r.querySelector(".popup__input_type_user-job"),i=document.querySelector(".profile__add-button"),a=document.querySelector(".popup_photo"),p=a.querySelector(".popup__form"),s=(a.querySelector(".popup__close-button"),a.querySelector(".popup__input_type_name-photo")),l=a.querySelector(".popup__input_type_link"),d=r.querySelector(".popup__form"),_=document.querySelector("#card").content,f=document.querySelector(".cards"),v=document.querySelectorAll(".popup"),y=document.querySelector(".popup_photo-card"),h=y.querySelector(".popup__title-photo"),m=y.querySelector(".popup__photo"),S=e.querySelector(".profile__avatar"),q=e.querySelector(".profile__avatar-hover"),L=document.querySelector(".popup_photo-profile"),E=L.querySelector(".popup__form"),T=document.querySelector(".popup_sure"),k=T.querySelector(".popup__confirmation"),b=".popup__save",x="popup__save_inactive",g="popup__input_type_error",C="popup__input-error_active",j="cfb5467c-bf03-4f53-98d0-54d36791533e",z="https://nomoreparties.co/v1/".concat("plus-cohort-9","/"),A=z+"/users/me",D=z+"/cards",P=function(e){return e.ok?e.json():Promise.reject("Ошибка: code ".concat(e.status))};function H(e){e.classList.add("popup_open"),document.addEventListener("keydown",N)}function I(e){e.classList.remove("popup_open"),document.removeEventListener("keydown",N)}function N(e){"Escape"===e.key&&I(document.querySelector(".popup_open"))}function O(e,t,o,n){var r=_.querySelector(".card").cloneNode(!0);r.cardId=n;var c=r.querySelector(".card__title"),u=r.querySelector(".card__photo"),i=r.querySelector(".card__like"),a=r.querySelector(".card__del"),p=r.querySelector(".card__like_count");return p.innerText=o,c.innerText=e,u.alt=e,u.src=t,a.addEventListener("click",(function(e){return function(e,t,o){e.preventDefault(),H(T),k.addEventListener("click",(function(){t.closest(".card").remove(),I(T),fetch("https://nomoreparties.co/v1/plus-cohort-9/cards/".concat(o),{method:"DELETE",headers:{authorization:j,"Content-Type":"application/json"}})}))}(e,a,r.cardId)})),i.addEventListener("click",(function(e){return function(e,t,o){e.target.classList.toggle("card__like_active");var n=parseInt(t.innerText);e.target.classList.contains("card__like_active")?(t.innerText=n+=1,fetch("https://nomoreparties.co/v1/plus-cohort-9/cards/likes/".concat(o),{method:"PUT",headers:{authorization:j,"Content-Type":"application/json"}})):(t.innerText=n-=1,fetch("https://nomoreparties.co/v1/plus-cohort-9/cards/likes/".concat(o),{method:"DELETE",headers:{authorization:j,"Content-Type":"application/json"}}))}(e,p,r.cardId)})),u.addEventListener("click",(function(){return function(e,t){m.src=t,m.alt=e,h.innerText=e,H(y)}(e,t)})),r}function w(e){e.classList.add(x)}v.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup__close-button")&&I(e),t.target===t.currentTarget&&I(e)}))}));var J=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(x):t.classList.add(x)};function M(e,t,o){e?t.querySelector(b).innerHTML="Сохранение...":o&&(t.querySelector(b).innerHTML=o)}fetch(A,{headers:{authorization:j}}).then(P).then((function(e){return console.log("Результат АПИ Профиля - ",e),e})).then((function(e){S.src=e.avatar,t.textContent=e.name,o.textContent=e.about})).catch((function(e){console.error("Ошибка - ",e)})),Array.from(document.querySelectorAll(".popup__form")).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e){var t=Array.from(e.querySelectorAll(".popup__input")),o=e.querySelector(b);J(t,o),t.forEach((function(n){n.addEventListener("input",(function(){(function(e,t){t.validity.valid?function(e,t){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(g),o.textContent="",o.classList.remove(C)}(e,t):function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.add(g),n.textContent=o,n.classList.add(C)}(e,t,t.validationMessage)})(e,n),J(t,o)}))}))}(e)})),q.addEventListener("click",(function(){w(E.querySelector(".popup__save")),H(L)})),n.addEventListener("click",(function(){H(r),c.value=t.innerText,u.value=o.innerText})),i.addEventListener("click",(function(){w(p.querySelector(".popup__save")),H(a)})),fetch(D,{headers:{authorization:j}}).then(P).then((function(e){return console.log("Результат АПИ карточек - ",e),e})).then((function(e){e.forEach((function(e){f.append(O(e.name,e.link,e.likes.length,e._id))}))})),p.addEventListener("submit",(function(e){e.preventDefault();var t=a.querySelector(".popup__save").innerText;M(!0,a,t);var o=s.value,n=l.value;fetch("https://nomoreparties.co/v1/plus-cohort-9/cards",{method:"POST",headers:{authorization:j,"Content-Type":"application/json"},body:JSON.stringify({name:o,link:n})}).then((function(e){return e.json()})).then((function(e){f.prepend(O(o,n,0,e._id))})).finally((function(){M(!1,a,t),I(a),p.reset()}))})),d.addEventListener("submit",(function(e){e.preventDefault(),t.textContent=c.value,o.textContent=u.value,fetch("https://nomoreparties.co/v1/plus-cohort-9/users/me",{method:"PATCH",headers:{authorization:j,"Content-Type":"application/json"},body:JSON.stringify({name:c.value,about:u.value})}),I(r)})),E.addEventListener("submit",(function(e){e.preventDefault();var t=L.querySelector(".popup__save").innerText;M(!0,L),S.src=L.querySelector(".popup__input_type_link").value,fetch("https://nomoreparties.co/v1/plus-cohort-9/users/me/avatar",{method:"PATCH",headers:{authorization:j,"Content-Type":"application/json"},body:JSON.stringify({avatar:S.src})}).catch((function(e){return console.log("Ошибка ",e)})).finally((function(){M(!1,L,t),I(L),E.reset()}))}))})();